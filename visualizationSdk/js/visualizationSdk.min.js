/* visualization sdk beta.v.1 - Wed Dec 03 2014 12:32:32 */var opopVisual=function(){var e,a,o,t,r,i,n,l,s,d,p,u={},c=document.querySelector("head")||document.querySelector("body"),g={map:{ugcCounter:1},carousel:{ugcCounter:1},grid:{ugcCounter:1}},m=[],f="grid-0pop",v="gutter-sizer-0pop",b="grid-item-0pop",h={},w={},M=widgets0pop.opopMapInfo?widgets0pop.opopMapInfo:w,y=widgets0pop.opopCarouselInfo?widgets0pop.opopCarouselInfo:w,C=widgets0pop.opopGridInfo?widgets0pop.opopGridInfo:w,L=[],k="https://s3.amazonaws.com/assets.offerpop.com/add_ons/visualizationSdk/",z={jQuery:{source:"https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"},"google.maps":{source:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization&callback=opopVisual.configureMap"},_:{source:k+"libs/underscore.1.7.0.min.js"},RichMarker:{source:k+"libs/rich-marker.js"},owlCarousel:{source:k+"libs/owlCarousel.js",css:k+"libs/owlCarousel.css"},masonry:{source:k+"libs/masonry.js"},imagesLoaded:{source:k+"libs/imagesLoaded.js"},modalTemplate:{source:k+"modal-temp-0pop.html"},carouselTemplate:{source:k+"carousel-temp-0pop.html"},gridTemplate:{source:k+"grid-temp-0pop.html"},"visualization-styles":{css:k+"css/styles.css"}};return u.general={_loadDependencies:function(){var e=document.createElement("div"),a=document.querySelector("body");e.id="fade-bg-0pop",a.appendChild(e),u.prepLib._parseLib("_"),u.prepLib._parseLib("jQuery"),u.prepLib._loadCSS("visualization-styles");for(var o in widgets0pop)L.push(widgets0pop[o].type)},_buildWidget:function(e){e[0]&&u[e[0]]._init(),L=e.slice(1,e.length)},_load_Temp:function(o,t){function r(t,r){if(!h[t]){var i,n=z[o+"Template"].source;e.ajax({url:n,method:"GET",async:!1,success:function(e){i=e}}),h[t]=a.template(i)}return h[t](r)}return console.log("data",t),s=r(o+"-temp-0pop",t)},_xhr:function(a,o){var t="https://api.offerpop.com/v1/ugc/collections/",r=a.campaignId,i=a.access_token,n=a.page_size||100,l=a.approval||"app",s=a.platform||"twitter%2Cinstagram",d=a.media_type||"video%2Cimage",p=a.order||"date_asc";return e.ajax({type:"GET",dataType:"json",url:t+r+"/?access_token="+i+"&page="+o+"&approval_status="+l+"&page_size="+n+"&social_platform="+s+"&order="+p+"&media_type="+d})},_ugcData:function(e,a,o){var t=a.media.media_urls,r=a.social_platform,i={author:a.author.username,avatar:a.author.profile.avatar,caption:a.text,medium_image:t.medium_image,large_image:t.large_image,network:r,timestamp:new Date(a.created_on).toDateString(),platform_link:o.social_platform_original_url,ugcCounter:g[e].ugcCounter};if("twitter"===r&&(i.platform_ref=a.platform_ref),"map"===e){var n=o.geo_data;n.coordinates["0"]?(i.latitude=n.coordinates["0"].latitude,i.longitude=n.coordinates["0"].longitude):(i.latitude=n.coordinates.latitude,i.longitude=n.coordinates.longitude)}return console.log(i),console.log(e),g[e]["item"+g[e].ugcCounter]=i,i}},u.prepLib={_parseLib:function(e){var a=u.prepLib,o="_"===e?a._noConflict:a._handleLoad;o(e)},_noConflict:function(e){void 0===window[e]?(console.log("handleload"),u.prepLib._handleLoad(e)):a=window._},_handleLoad:function(e){z[e].elem=document.createElement("script"),z[e].elem.src=z[e].source,z[e].elem.readyState?z[e].elem.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&"google.maps"!=e&&u.prepLib._loadSteps(e)}:"google.maps"!=e&&(z[e].elem.onload=function(){u.prepLib._loadSteps(e)}),c.appendChild(z[e].elem)},_loadSteps:function(o){switch(o){case"_":a=_.noConflict(),console.log("_.noconf:",a.VERSION);break;case"jQuery":e=window.jQuery.noConflict(!0),console.log(e.fn.jquery),u.general._buildWidget(L);break;case"RichMarker":u.mapManager._pullFeed(1);break;case"owlCarousel":owlCarouselPrivate(e,window,document),u.carouselManager._pullFeed(1);break;case"masonry":u.gridManager._pullFeed(1)}},_loadCSS:function(e){var a=document.createElement("link");a.rel="stylesheet",a.href=z[e].css,c.appendChild(a)}},u.modal={_pinModalEvents:function(){function a(e,a){var o=e.id;currentItem=g[a][o];var t=u.general._load_Temp("modal",currentItem);u.modal._populateModal(t)}d=e("#map-canvas-0pop"),p=e("#fade-bg-0pop"),i=e(".res-carousel-0pop"),n=e("#"+f),t=".ugc-content-0pop",d.on({mouseenter:function(){e(this).css({position:"relative","z-index":"99999"})},mouseleave:function(){e(this).css({"z-index":"1"})}},t),d.on("click",t,function(){a(this,"map")}),i.on("click",".lazyOwl",function(){a(this,"carousel")}),n.on("click","."+b,function(){a(this,"grid")}),p.on("click",".modal-close-0pop",function(){p.fadeOut(),e("body").css("overflow","auto"),i.trigger("owl.play",u.defaults.carousel.autoPlay)})},_populateModal:function(a){p.empty(),p.append(a),e("body").css("overflow","hidden"),p.fadeIn()}},u.mapManager={_init:function(){u.prepLib._parseLib("google.maps")},configureMap:function(){var e={zoom:u.defaults.map.zoom,center:new google.maps.LatLng(u.defaults.map.center.lat,u.defaults.map.center.long),minZoom:2};o=new google.maps.Map(document.getElementById("map-canvas-0pop"),e),u.prepLib._parseLib("RichMarker")},_pullFeed:function(e){u.general._xhr(M,e).done(function(e){var a=e._embedded["ugc:item"];if(u.modal._pinModalEvents(),u.mapManager._storeUGC(a),e._links.next.href){var t=e._links.next.href,r=t.indexOf("&page="),i=t.slice(r+6,t.length);console.log(i),u.mapManager._pullFeed(i)}else{if(g.map.item1){var n=g.map.item1,l=new google.maps.LatLng(n.latitude,n.longitude);o.panTo(l)}u.defaults.heat.enabled&&u.mapManager.addons._heatMap(),u.general._buildWidget(L)}})},_storeUGC:function(e){for(var a in e){var o=e[a].content,t=o.platform_data;if(t&&o.media&&t.geo_data&&t.geo_data.coordinates){var r=u.general._ugcData("map",o,t);m.push(new google.maps.LatLng(r.latitude,r.longitude)),u.mapManager._createMarker(r),g.map.ugcCounter++}}},_createMarker:function(e){var a=new google.maps.LatLng(e.latitude,e.longitude),t=new RichMarker({position:a,map:o,content:'<div class="ugc-content-0pop" id="item'+g.map.ugcCounter+'" style="background-image:url('+u.defaults.map.pin+');"></div>'});t.setMap(o)}},u.mapManager.addons={_heatMap:function(){var e=new google.maps.MVCArray(m);r=new google.maps.visualization.HeatmapLayer({data:e}),r.set("radius",u.defaults.heat.radius),r.set("gradient",u.defaults.heat.gradient),u.mapManager.addons._toggleHeat()},_toggleHeat:function(){google.maps.event.addListener(o,"zoom_changed",function(){var a=o.getZoom(),t=e(".ugc-content-0pop");u.defaults.map.zoom>a?(t.hide(),r.setMap(o)):(t.show(),r.setMap(null))})}},u.carouselManager={_init:function(){u.prepLib._parseLib("owlCarousel"),u.prepLib._loadCSS("owlCarousel")},_pullFeed:function(e){u.general._xhr(y,e).done(function(e){var a=e._embedded["ugc:item"];u.modal._pinModalEvents(),u.carouselManager._storeUGC(a),u.general._buildWidget(L)})},_storeUGC:function(e){for(var a in e){var o=e[a].content,t=o.platform_data;t&&o.media&&o.media.media_urls&&u.general._ugcData("carousel",o,t),g.carousel.ugcCounter++}u.carouselManager._buildCarousel()},_buildCarousel:function(){for(var a=u.defaults.carousel,o=e(".res-carousel-0pop").length,t=Math.floor(g.carousel.ugcCounter/o),r=1,n=t,l=1;o>=l;l++){for(var s=r;n>s;s++){currentItem=g.carousel["item"+s];var d=u.general._load_Temp("carousel",currentItem);e("#carousel-0pop"+l).append(d)}r+=t,n+=t+1}console.log(r),i.owlCarousel({items:a.items,itemsDesktop:a.itemsDesktop,itemsDesktopSmall:a.itemsDesktopSmall,itemsTablet:a.itemsTablet,itemsMobile:a.itemsMobile,lazyLoad:a.lazyLoad,navigation:a.navigation,autoPlay:a.autoPlay,rewindNav:a.rewindNav,responsive:a.responsive,afterUpdate:u.carouselManager.setHeight}),u.carouselManager.setHeight()},setHeight:function(){var a=e(".lazyOwl").css("width");e(".lazyOwl").css("height",a)}},u.gridManager={_init:function(){u.prepLib._parseLib("imagesLoaded"),u.prepLib._parseLib("masonry"),e("#"+f).append('<div class="'+v+'"></div>')},_pullFeed:function(e){l=u.defaults.grid.area+1,u.general._xhr(C,e).done(function(e){var a=e._embedded["ugc:item"];u.modal._pinModalEvents(),u.gridManager._storeUGC(a),u.general._buildWidget(L)})},_storeUGC:function(a){for(var o in a){var t=a[o].content,r=t.platform_data;if(r&&t.media&&t.media.media_urls)if(u.general._ugcData("grid",t,r),currentItem=g.grid["item"+g.grid.ugcCounter],g.grid.ugcCounter<=u.defaults.grid.area){var i=u.general._load_Temp("grid",currentItem);e(i).appendTo(n)}else g.grid.ugcCounter===u.defaults.grid.area+1&&u.gridManager._buildGrid();g.grid.ugcCounter++}},_buildGrid:function(){var a=e("."+v).width(),o=n.width(),t=u.defaults.grid.columns-1,r=Math.round(100*a/o),i=t*r,l=(100-i)/u.defaults.grid.columns;e("."+b).css("width",l+"%");var s=document.querySelector("#"+f),d=new Masonry(s,{columnWidth:0,gutter:"."+v,itemSelector:"."+b});imagesLoaded(s,function(){d.layout()}),u.gridManager.addons.random()}},u.gridManager.addons={random:function(){function a(e){return Math.floor(Math.random()*e)+1}var o=a(u.defaults.grid.area);e("#grid-0pop #item"+o+" img").fadeOut().attr("src",g.grid["item"+l].medium_image).fadeIn(),e("#grid-0pop #item"+o).attr("id","item"+l),l++,window.setTimeout("opopVisual.random()",u.defaults.grid.random)},all:function(){window.setTimeout("opopVisual.all()",u.defaults.grid.all),e(".grid-item-0pop img").attr("src",g.grid["item"+l].medium_image),l++}},u.defaults={map:{pin:M.pin||k+"images/opop_map_pin.png",zoom:M.zoom||13,center:{lat:M.lat||40.7508095,"long":M.long||-73.9887535}},heat:{enabled:M.heat||!1,radius:M.radius||20,gradient:M.gradient||["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]},carousel:{items:y.items||5,itemsDesktop:[1199,y.items||5],itemsDesktopSmall:[979,y.itemsDesktopSm||3],itemsTablet:[768,y.itemsTablet||3],itemsMobile:[479,y.itemsMobile||1],lazyLoad:y.lazy||!0,navigation:y.navigation||!0,autoPlay:y.autoPlay||4e3,rewindNav:y.rewindNav||!0,responsive:y.responsive||!0},grid:{rows:C.rows||3,columns:C.columns||5,area:C.rows*C.columns||15,random:C.interval||3e3,all:C.interval||3e3}},u.general._loadDependencies(),{configureMap:u.mapManager.configureMap,random:u.gridManager.addons.random,all:u.gridManager.addons.all}}();